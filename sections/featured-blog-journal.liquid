{{ 'component-card.css' | asset_url | stylesheet_tag }}
{{ 'component-article-card.css' | asset_url | stylesheet_tag }}
{{ 'section-featured-blog.css' | asset_url | stylesheet_tag }}

{%- style -%}
.section-{{ section.id }}-wrap{padding-top:{{ section.settings.padding_top | times:0.75 | round:0 }}px;padding-bottom:{{ section.settings.padding_bottom | times:0.75 | round:0 }}px}
@media(min-width:750px){.section-{{ section.id }}-wrap{padding-top:{{ section.settings.padding_top }}px;padding-bottom:{{ section.settings.padding_bottom }}px}}

.blog-collage__header{display:flex;gap:1rem;align-items:flex-start;justify-content:space-between;margin-bottom:1.25rem}
.blog-collage__filters{display:flex;gap:.75rem;flex-wrap:wrap}
.blog-collage__filters .select{min-width:200px}

.blog-collage__grid{display:grid;grid-template-columns:1fr;gap:20px}
@media(min-width:990px){.blog-collage__grid{grid-template-columns:repeat(3,1fr)}}

/* Wide item spans full row on desktop */
.blog-collage__item--wide{grid-column:1 / -1}

/* Optional visual tweaks for wide card to feel “feature” */
.blog-collage__item--wide .article-card .ratio{--ratio-percent:45%}
.blog-collage__item--wide .article-card .card__content .card__heading{font-size:clamp(1.25rem,1.2vw + 1rem,2rem)}

/* Keep cards full-height per row for nice lines on desktop */
@media(min-width:990px){
  .blog-collage__item .article-card-wrapper,
  .blog-collage__item .article-card{height:100%}
}

.blog-collage__viewall{margin-top:1.25rem}
{%- endstyle -%}

{%- if section.settings.blog == blank -%}
  <div class="page-width section-{{ section.id }}-wrap">
    <p>Add a Blog in section settings.</p>
  </div>
  {% break %}
{%- endif -%}

{%- liquid
  assign blog_obj = section.settings.blog
  assign max_posts = section.settings.post_limit
-%}

<div class="blog color-{{ section.settings.color_scheme }} gradient">
  <div class="page-width section-{{ section.id }}-wrap">

    <!-- Header + Filters -->
    <div class="blog-collage__header">
      <div class="title-wrapper-with-link">
        {%- unless section.settings.heading == blank -%}
          <h2 id="SectionHeading-{{ section.id }}"
              class="inline-richtext {{ section.settings.heading_size }}{% if settings.animations_reveal_on_scroll %} scroll-trigger animate--slide-in{% endif %}"
              {% if settings.animations_reveal_on_scroll %} data-cascade {% endif %}>
            {{ section.settings.heading }}
          </h2>
        {%- endunless -%}
      </div>

      <div class="blog-collage__filters">
        {%- if section.settings.show_tag_filter -%}
          <div class="select">
            <select id="BlogTagFilter-{{ section.id }}" aria-label="Filter by tag">
              <option value="{{ blog_obj.url }}" {% unless current_tags %}selected{% endunless %}>{{ 'blogs.general.view_all' | t }}</option>
              {%- for tag in blog_obj.all_tags -%}
                <option value="{{ blog_obj.url }}/tagged/{{ tag | handleize }}" {% if current_tags contains tag %}selected{% endif %}>{{ tag }}</option>
              {%- endfor -%}
            </select>
          </div>
        {%- endif -%}

        {%- if section.settings.filter_menu != blank -%}
          <nav class="menu">
            <ul class="list-unstyled list-inline">
              {%- for l in section.settings.filter_menu.links -%}
                <li style="display:inline-block;margin-left:.5rem">
                  <a class="link" href="{{ l.url }}">{{ l.title }}</a>
                </li>
              {%- endfor -%}
            </ul>
          </nav>
        {%- endif -%}
      </div>
    </div>

    {%- comment -%}
      Collage pattern (desktop): 1,3,3,1,3,3 repeating.
      We'll render items and add a "wide" class when (index0 % 7) == 0.
      Otherwise, items are standard thirds in the 3-col grid.
    {%- endcomment -%}
    <ul class="blog-collage__grid" role="list">
      {%- if blog_obj.articles_count > 0 -%}
        {%- for article in blog_obj.articles limit: max_posts -%}
          {%- assign pos = forloop.index0 | modulo: 7 -%}
          {%- assign is_wide = false -%}
          {%- if pos == 0 -%}{%- assign is_wide = true -%}{%- endif -%}

          <li class="blog-collage__item {% if is_wide %}blog-collage__item--wide{% endif %}">
            {%- render 'article-card',
              blog: blog_obj,
              article: article,
              media_aspect_ratio: is_wide | default: false | unless: false | endunless | default: 1.66,
              show_image: section.settings.show_image,
              show_date: section.settings.show_date,
              show_author: section.settings.show_author,
              show_excerpt: true
            -%}
          </li>
        {%- endfor -%}
      {%- else -%}
        {%- for i in (1..max_posts) -%}
          <li class="blog-collage__item {% if forloop.index0 == 0 %}blog-collage__item--wide{% endif %}">
            <div class="article-card-wrapper card-wrapper">
              <div class="card article-card {% if section.settings.show_image %}card--media{% else %}card--text{% endif %}">
                <div class="card__content">
                  <div class="card__information">
                    <h3 class="card__heading h3">{{ 'sections.featured_blog.onboarding_title' | t }}</h3>
                  </div>
                </div>
              </div>
            </div>
          </li>
        {%- endfor -%}
      {%- endif -%}
    </ul>

    {%- if section.settings.show_view_all and max_posts < blog_obj.articles_count -%}
      <div class="blog-collage__viewall">
        <a href="{{ blog_obj.url }}" class="button button--secondary">Read more</a>
      </div>
    {%- endif -%}
  </div>
</div>

<script>
  (function(){
    var sel = document.getElementById('BlogTagFilter-{{ section.id }}');
    if (!sel) return;
    sel.addEventListener('change', function(e){
      window.location.href = e.target.value;
    }, {passive:true});
  })();
</script>

{% schema %}
{
  "name": "Featured Blog (Journal)",
  "tag": "section",
  "disabled_on": { "groups": ["header", "footer"] },
  "settings": [
    { "type": "blog", "id": "blog", "label": "Blog" },

    { "type": "header", "content": "Heading" },
    { "type": "inline_richtext", "id": "heading", "default": "Latest stories", "label": "Heading" },
    { "type": "select", "id": "heading_size",
      "options": [
        { "value": "h2", "label": "H2" },
        { "value": "h1", "label": "H1" },
        { "value": "h0", "label": "H0" },
        { "value": "hxl", "label": "HXL" },
        { "value": "hxxl", "label": "HXXL" }
      ],
      "default": "h1",
      "label": "Heading size"
    },

    { "type": "header", "content": "Filters" },
    { "type": "checkbox", "id": "show_tag_filter", "label": "Show Tag dropdown (from blog tags)", "default": true },
    { "type": "link_list", "id": "filter_menu", "label": "Optional filter menu" },

    { "type": "header", "content": "Cards" },
    { "type": "range", "id": "post_limit", "min": 1, "max": 24, "step": 1, "default": 13, "label": "Max posts to show" },
    { "type": "checkbox", "id": "show_view_all", "default": true, "label": "Show “Read more” button" },
    { "type": "checkbox", "id": "show_image", "default": true, "label": "Show image" },
    { "type": "checkbox", "id": "show_date", "default": true, "label": "Show date" },
    { "type": "checkbox", "id": "show_author", "default": false, "label": "Show author" },

    { "type": "header", "content": "Colors" },
    { "type": "color_scheme", "id": "color_scheme", "label": "Color scheme", "info": "Has cards info", "default": "scheme-1" },

    { "type": "header", "content": "Spacing" },
    { "type": "range", "id": "padding_top", "min": 0, "max": 100, "step": 4, "unit": "px", "label": "Top padding", "default": 36 },
    { "type": "range", "id": "padding_bottom", "min": 0, "max": 100, "step": 4, "unit": "px", "label": "Bottom padding", "default": 36 }
  ],
  "presets": [
    { "name": "Featured Blog (Journal)" }
  ]
}
{% endschema %}
