{% comment %}
  Testimonial Slider (debug build)
{% endcomment %}

{%- style -%}
.section-{{ section.id }}-padding{
    padding-top:{{ section.settings.padding_top | times: 0.75 | round: 0 }}px;
    padding-bottom:{{ section.settings.padding_bottom | times: 0.75 | round: 0 }}px;
    overflow-x: clip;
}
@media (min-width:750px){
    .section-{{ section.id }}-padding{
        padding-top:{{ section.settings.padding_top }}px;
        padding-bottom:{{ section.settings.padding_bottom }}px;
    }
}
/* Two-column layout */
.section-{{ section.id }}-padding .ts-grid{ 
    display:flex; 
    gap:0; 
    align-items:flex-start; 
}
.section-{{ section.id }}-padding .ts-left{ 
    flex:0 0 25%; 
}
.section-{{ section.id }}-padding .ts-right { 
    flex: 0 0 75%; 
    width: 100%;
    position: relative; 
}
.section-{{ section.id }}-padding .ts-left h2{
    color:#F4F8FB; margin:0; line-height:1.1; max-width:200px;
}
/* RIGHT-BLEED */
.section-{{ section.id }}-padding .ts-bleed{
    width: calc(100% + max(0px, 50vw - 50%));
    margin-right: max(0px, calc(50vw - 50%));
    margin-left: 0;
}

  /* --- Minimal Swiper fallbacks (if CSS asset misses) --- */
  .section-{{ section.id }}-padding .tswiper{ overflow:hidden; }
  .section-{{ section.id }}-padding .tswiper .swiper-wrapper{ display:flex; }
  .section-{{ section.id }}-padding .tswiper .swiper-slide{ flex-shrink:0; height:auto; }

  /* Keep JS spaceBetween in sync with any width maths you add later */
  .section-{{ section.id }}-padding .tswiper{ --g: {{ section.settings.gap | default: 24 }}px; }

  /* Card styling */
  .section-{{ section.id }}-padding .ts-card{
    background:#fff; border-radius:16px; padding:2rem;
    min-height:400px; display:flex; flex-direction:column; gap:14px;
    box-shadow:0 1px 2px rgba(0,0,0,.05), 0 6px 24px rgba(0,0,0,.06);
  }
  .section-{{ section.id }}-padding[style*="background-color"] .ts-card{ background:rgba(255,255,255,0.98); }
  .section-{{ section.id }}-padding .ts-stars{ letter-spacing:2px; font-size:18px; line-height:1; opacity:.9; }
  .section-{{ section.id }}-padding .ts-title{ margin:0; }
  .section-{{ section.id }}-padding .ts-desc{ color:#333; opacity:.9; }
  .section-{{ section.id }}-padding .ts-person{ font-weight:600; color:#555; }

  /* Product footer pinned to bottom */
  .section-{{ section.id }}-padding .ts-prod{
    margin-top:auto; display:grid; grid-template-columns:88px 1fr; gap:16px;
    align-items:center; border-top:1px solid rgba(0,0,0,.08); padding-top:16px;
  }
  .section-{{ section.id }}-padding .ts-prod-img img{
    width:88px; height:88px; object-fit:contain; border-radius:8px; background:#f6f6f6;
  }
  .section-{{ section.id }}-padding .ts-prod-title{ font-weight:700; margin-bottom:8px; }

  /* Arrows */
  .section-{{ section.id }}-padding .ts-nav{
    display:flex; justify-content:center; gap:24px; margin-top:16px;
  }
  .section-{{ section.id }}-padding .ts-btn{
    appearance:none; border:1px solid rgba(0,0,0,.15); background:#fff;
    border-radius:999px; width:48px; height:48px; display:grid; place-items:center; cursor:pointer;
  }
  .section-{{ section.id }}-padding .ts-btn:hover{ border-color:rgba(0,0,0,.35); }
{%- endstyle -%}


<section
  id="testimonial-slider-{{ section.id }}"
  class="section-{{ section.id }}-padding"
  data-testimonial-slider
  style="{% if section.settings.bg_color != blank %}background-color: {{ section.settings.bg_color }};{% endif %}"
>
  <div class="page-width">

    <div class="ts-grid">
      <div class="ts-left">
        {% if section.settings.heading != blank %}
            <div>
                <h2 class="inline-richtext h2 scroll-trigger animate--slide-in">{{ section.settings.heading }}</h2>
            </div>
        {% endif %}
      </div>

      <div class="ts-right">
        <div class="ts-bleed" data-ts-root>
          <div
            id="tswiper-{{ section.id }}"
            class="swiper tswiper"
            aria-label="{{ section.settings.heading | escape | default: 'Testimonials' }}"
            data-speed="{{ section.settings.speed | default: 500 }}"
            data-gap="{{ section.settings.gap | default: 24 }}"
            data-autoplay="{{ section.settings.autoplay | default: false }}"
            data-autoplay-delay="{{ section.settings.autoplay_delay | default: 4000 }}"
            >
            <div class="swiper-wrapper">
              {%- for block in section.blocks -%}
                {%- assign b = block.settings -%}
                {%- assign prod = b.product -%}
                <div class="swiper-slide" {{ block.shopify_attributes }}>
                  <article class="ts-card">
                    {% if section.settings.show_stars %}
                      <div class="ts-stars" aria-label="{{ section.settings.star_count }} out of 5 stars">
                        {%- for i in (1..section.settings.star_count) -%}★{%- endfor -%}
                      </div>
                    {% endif %}

                    {% if b.title != blank %}
                      <h3 class="ts-title h3">{{ b.title }}</h3>
                    {% endif %}

                    {% if b.description != blank %}
                      <div class="ts-desc rte">{{ b.description }}</div>
                    {% endif %}

                    {% if b.person != blank %}
                      <div class="ts-person">{{ b.person }}</div>
                    {% endif %}

                    {% if prod != blank %}
                      <div class="ts-prod">
                        <div class="ts-prod-img">
                          {% if prod.featured_media %}
                            {{ prod.featured_media | image_url: width: 160 | image_tag: loading: 'lazy', widths: '160,320', alt: prod.title }}
                          {% elsif prod.featured_image %}
                            {{ prod.featured_image | image_url: width: 160 | image_tag: loading: 'lazy', widths: '160,320', alt: prod.title }}
                          {% endif %}
                        </div>
                        <div class="ts-prod-meta">
                          <div class="ts-prod-title">{{ prod.title }}</div>
                          <a href="{{ prod.url }}" class="button button--primary">{{ section.settings.shop_cta | default: 'Shop now' }}</a>
                        </div>
                      </div>
                    {% endif %}
                  </article>
                </div>
              {%- endfor -%}
            </div>
          </div>

          {% if section.settings.show_arrows %}
            <div class="ts-nav">
              <button class="ts-btn ts-prev" aria-label="Previous"><span aria-hidden="true">←</span></button>
              <button class="ts-btn ts-next" aria-label="Next"><span aria-hidden="true">→</span></button>
            </div>
          {% endif %}
        </div>
      </div>
    </div>
  </div>
</section>


{% schema %}
{
  "name": "Testimonial Slider",
  "class": "section",
  "settings": [
    { "type": "text", "id": "heading", "label": "Heading", "default": "Real customers, real results." },
    { "type": "color", "id": "bg_color", "label": "Background color", "default": "#221D46" },
    { "type": "checkbox", "id": "show_stars", "label": "Show stars", "default": true },
    { "type": "range", "id": "star_count", "min": 3, "max": 5, "step": 1, "label": "Star count", "default": 5 },
    { "type": "text", "id": "shop_cta", "label": "CTA label", "default": "Shop now" },
    { "type": "range", "id": "padding_top", "min": 0, "max": 100, "step": 4, "unit": "px", "label": "Padding top", "default": 56 },
    { "type": "range", "id": "padding_bottom", "min": 0, "max": 100, "step": 4, "unit": "px", "label": "Padding bottom", "default": 56 },
    { "type": "checkbox", "id": "show_arrows", "label": "Show arrows", "default": true },
    { "type": "range", "id": "gap", "label": "Slide gap", "min": 0, "max": 48, "step": 2, "default": 24 },
    { "type": "range", "id": "speed", "label": "Transition speed (ms)", "min": 100, "max": 1200, "step": 50, "default": 500 },
    { "type": "checkbox", "id": "autoplay", "label": "Autoplay", "default": false },
    { "type": "range", "id": "autoplay_delay", "label": "Autoplay delay (ms)", "min": 1500, "max": 8000, "step": 100, "default": 4000 }
  ],
  "blocks": [
    {
      "type": "testimonial",
      "name": "Testimonial",
      "settings": [
        { "type": "text", "id": "title", "label": "Title", "default": "Heart Health Support" },
        { "type": "richtext", "id": "description", "label": "Description", "default": "<p>This is my go-to supplement for science-proven heart health support.</p>" },
        { "type": "text", "id": "person", "label": "Person", "default": "Brian, USA" },
        { "type": "product", "id": "product", "label": "Related product (optional)" }
      ]
    }
  ],
  "max_blocks": 24,
  "presets": [
    { "name": "Testimonial Slider", "blocks": [ { "type": "testimonial" }, { "type": "testimonial" }, { "type": "testimonial" } ] }
  ]
}
{% endschema %}
