{% comment %} Testimonial Slider {% endcomment %}

{%- style -%}
  /* Section padding (Dawn convention) */
  .section-{{ section.id }}-padding{
    padding-top:{{ section.settings.padding_top | times: 0.75 | round: 0 }}px;
    padding-bottom:{{ section.settings.padding_bottom | times: 0.75 | round: 0 }}px;
    overflow-x: clip; /* no sideways scroll on right-bleed */
  }
  @media (min-width:750px){
    .section-{{ section.id }}-padding{
      padding-top:{{ section.settings.padding_top }}px;
      padding-bottom:{{ section.settings.padding_bottom }}px;
    }
  }

  /* Heading */
  .section-{{ section.id }}-padding .ts2-heading{ margin:0 0 2rem 0; }

  /* Right-only bleed (from page-width to screen edge) */
  .section-{{ section.id }}-padding .ts2-bleed{
    --right-gutter: max(0px, calc((100vw - var(--page-width)) / 2 + var(--page-width-margin)));
    width: calc(100% + var(--right-gutter));
    margin-right: var(--right-gutter);
  }

  /* Swiper fallbacks */
  .section-{{ section.id }}-padding .ts2-swiper{ overflow:hidden; --g: {{ section.settings.gap | default: 32 }}px; }
  .section-{{ section.id }}-padding .ts2-swiper .swiper-wrapper{ display:flex; }
  .section-{{ section.id }}-padding .ts2-swiper .swiper-slide{ flex-shrink:0; height:auto; }

  /* Fixed-width mode → keep exactly ~1.2 slides in view */
  .section-{{ section.id }}-padding .ts2-swiper[data-mode="fixed"] .swiper-slide{
    /* each slide width = (container - gap) / 1.2  */
    width: calc((100% - var(--g)) / 1.2);
    transition: opacity .25s ease;
    opacity: .35;                /* dim non-active */
  }
  .section-{{ section.id }}-padding .ts2-swiper .swiper-slide.swiper-slide-active{ opacity: 1; }

  /* Card layout (image left, text right) */
  .section-{{ section.id }}-padding .ts2-card{
    background:#fff; border-radius:16px; padding:2rem;
    display:grid; grid-template-columns: 420px 1fr; gap: 4rem;
    box-shadow:0 1px 2px rgba(0,0,0,.05), 0 6px 24px rgba(0,0,0,.06);
  }
  @media (max-width: 989px){
    .section-{{ section.id }}-padding .ts2-card{ grid-template-columns: 1fr; gap: 2rem; }
  }

  .section-{{ section.id }}-padding .ts2-photo{
    border-radius:16px; overflow:hidden;
    aspect-ratio: 4 / 5; /* adjust if needed */
    background:#f3f4f6;
  }
  .section-{{ section.id }}-padding .ts2-photo img{ width:100%; height:100%; object-fit:cover; display:block; }

  .section-{{ section.id }}-padding .ts2-quote{
    font-size: clamp(1.6rem, 1.2rem + .6vw, 2rem);
    line-height: 1.5;
    color:#1f2937;
    margin:0 0 1.25rem 0;
  }
  .section-{{ section.id }}-padding .ts2-name{ font-weight:700; margin:0 0 .25rem 0; }
  .section-{{ section.id }}-padding .ts2-role{ color:#6b7280; }

  /* Pagination dots (no arrows) */
  .section-{{ section.id }}-padding .ts2-pagination{ text-align:left; margin-top: 2rem; }
  .section-{{ section.id }}-padding .ts2-pagination .swiper-pagination-bullet{
    width:8px; height:8px; border-radius:999px; background:#9ca3af; opacity:.5;
  }
  .section-{{ section.id }}-padding .ts2-pagination .swiper-pagination-bullet-active{
    background:#111827; opacity:1;
  }
{%- endstyle -%}

<section
  id="testimonial-slider-{{ section.id }}"
  class="section-{{ section.id }}-padding"
  data-testimonial-slider
  style="{% if section.settings.bg_color != blank %}background-color: {{ section.settings.bg_color }};{% endif %}"
>
  <div class="page-width">
    {% if section.settings.heading != blank %}
      <h2 class="ts2-heading h2">{{ section.settings.heading }}</h2>
    {% endif %}
  </div>

  <!-- slider starts inside page-width then bleeds to right edge -->
  <div class="page-width">
    <div class="ts2-bleed">
      <div
        class="swiper ts2-swiper"
        data-mode="fixed"
        data-gap="{{ section.settings.gap | default: 32 }}"
        data-speed="{{ section.settings.speed | default: 500 }}"
        data-autoplay="{{ section.settings.autoplay | default: false }}"
        data-autoplay-delay="{{ section.settings.autoplay_delay | default: 4000 }}"
        data-dots="true"
      >
        <div class="swiper-wrapper">
          {%- for block in section.blocks -%}
            {%- assign b = block.settings -%}
            <div class="swiper-slide" {{ block.shopify_attributes }}>
              <article class="ts2-card">
                <div class="ts2-photo">
                  {% if b.image != blank %}
                    {{ b.image | image_url: width: 1200 | image_tag: loading: 'lazy', sizes: '(min-width: 990px) 420px, 100vw', widths: '420,640,840,1200', alt: b.name | escape }}
                  {% endif %}
                </div>
                <div class="ts2-copy">
                  {% if b.quote != blank %}
                    <p class="ts2-quote">“{{ b.quote | strip_html | escape }}”</p>
                  {% endif %}
                  {% if b.name != blank %}
                    <p class="ts2-name">{{ b.name }}</p>
                  {% endif %}
                  {% if b.role != blank %}
                    <p class="ts2-role">{{ b.role }}</p>
                  {% endif %}
                </div>
              </article>
            </div>
          {%- endfor -%}
        </div>
      </div>
    </div>
  </div>

  <!-- dots live inside the page-width, left aligned -->
  <div class="page-width">
    <div class="ts2-pagination swiper-pagination"></div>
  </div>
</section>

{% schema %}
{
  "name": "Testimonial slider",
  "class": "section",
  "settings": [
    { "type": "text", "id": "heading", "label": "Heading", "default": "Our Health Ambassadors" },
    { "type": "color", "id": "bg_color", "label": "Background color", "default": "#FFFFFF" },
    { "type": "range", "id": "gap", "label": "Slide gap (px)", "min": 0, "max": 48, "step": 2, "default": 32 },
    { "type": "range", "id": "speed", "label": "Transition speed (ms)", "min": 100, "max": 1200, "step": 50, "default": 500 },
    { "type": "checkbox", "id": "autoplay", "label": "Autoplay", "default": false },
    { "type": "range", "id": "autoplay_delay", "label": "Autoplay delay (ms)", "min": 1500, "max": 8000, "step": 100, "default": 4000 },
    { "type": "range", "id": "padding_top", "min": 0, "max": 100, "step": 4, "unit": "px", "label": "Padding top", "default": 56 },
    { "type": "range", "id": "padding_bottom", "min": 0, "max": 100, "step": 4, "unit": "px", "label": "Padding bottom", "default": 56 }
  ],
  "blocks": [
    {
      "type": "testimonial",
      "name": "Testimonial",
      "settings": [
        { "type": "image_picker", "id": "image", "label": "Image" },
        { "type": "text", "id": "name", "label": "Name", "default": "Dr Joel Kahn" },
        { "type": "text", "id": "role", "label": "Role", "default": "MD, Cardiologist" },
        { "type": "textarea", "id": "quote", "label": "Quote", "default": "Lorem Ipsum is simply dummy text of the printing and typesetting industry." }
      ]
    }
  ],
  "max_blocks": 10,
  "presets": [
    { "name": "Testimonial slider", "blocks": [ { "type": "testimonial" }, { "type": "testimonial" }, { "type": "testimonial" } ] }
  ]
}
{% endschema %}
