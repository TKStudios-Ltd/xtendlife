{% comment %} Featured Product Slider {% endcomment %}
{%- liquid
  assign col = section.settings.collection
  assign limit = section.settings.limit | default: 6
  assign prods = col.products | slice: 0, limit
-%}

{%- style -%}
.section-{{ section.id }}-padding{
  padding-top: {{ section.settings.padding_top | times: 0.75 | round: 0 }}px;
  padding-bottom: {{ section.settings.padding_bottom | times: 0.75 | round: 0 }}px;
}
@media (min-width:750px){
  .section-{{ section.id }}-padding{
    padding-top: {{ section.settings.padding_top }}px;
    padding-bottom: {{ section.settings.padding_bottom }}px;
  }
}

/* Header */
.section-{{ section.id }}-padding .fps-head{
  display:flex; align-items:center; justify-content:space-between; gap:1rem; margin-bottom:1.5rem;
}
.section-{{ section.id }}-padding .fps-heading{ margin:0; }

/* Arrows (top-right) */
.section-{{ section.id }}-padding .fps-arrows{ display:flex; gap:.75rem; }
.section-{{ section.id }}-padding .fps-btn{
  appearance:none; border:1px solid rgba(0,0,0,.15); background:#fff;
  width:42px; height:42px; border-radius:999px; display:grid; place-items:center; cursor:pointer;
}
.section-{{ section.id }}-padding .fps-btn:hover{ border-color:rgba(0,0,0,.35); }

/* Swiper base */
.section-{{ section.id }}-padding .fps-swiper .swiper-wrapper{ display:flex; }
.section-{{ section.id }}-padding .fps-swiper .swiper-slide{ height:auto; }

/* Card: media left, info right */
.section-{{ section.id }}-padding .fps-card{
  background:#fff; border-radius:16px; box-shadow:0 1px 2px rgba(0,0,0,.05), 0 6px 24px rgba(0,0,0,.06);
  padding:2rem; display:grid; grid-template-columns: 1fr 1fr; gap:2rem;
}
@media (max-width:989px){
  .section-{{ section.id }}-padding .fps-card{ grid-template-columns: 1fr; }
}
.section-{{ section.id }}-padding .fps-media{ border-radius:12px; overflow:hidden; background:#f5f5f5; }
.section-{{ section.id }}-padding .fps-media img{ width:100%; height:100%; object-fit:contain; display:block; }
.section-{{ section.id }}-padding .fps-title{ margin:0 0 .5rem 0; }
.section-{{ section.id }}-padding .fps-cta{ margin-top:1rem; }

/* Optional: keep bullets off; this slider uses arrows only */
.section-{{ section.id }}-padding .swiper-pagination{ display:none; }
{%- endstyle -%}

<section class="section-{{ section.id }}-padding" data-swiper-root>
  <div class="page-width">
    <div class="fps-head">
      <h2 class="fps-heading h2">{{ section.settings.heading | escape }}</h2>
      {% if section.settings.show_arrows %}
      <div class="fps-arrows">
        <button class="fps-btn fps-prev" aria-label="Previous">ARROW</button>
        <button class="fps-btn fps-next" aria-label="Next" style="transform:scaleX(-1)">ARROW</button>
      </div>
      {% endif %}
    </div>

    <div
      class="swiper fps-swiper"
      data-swiper                         <!-- universal hydrator picks this up -->
      data-slides="1"                     <!-- always 1 per view -->
      data-gap="{{ section.settings.gap | default: 24 }}"
      data-speed="{{ section.settings.speed | default: 500 }}"
      data-autoplay="{{ section.settings.autoplay | default: false }}"
      data-autoplay-delay="{{ section.settings.autoplay_delay | default: 4000 }}"
      data-nav-prev=".fps-prev"           <!-- scoped custom arrows -->
      data-nav-next=".fps-next"
    >
      <div class="swiper-wrapper">
        {%- if col and prods.size > 0 -%}
          {%- for product in prods -%}
            <div class="swiper-slide">
              <article class="fps-card">
                <div class="fps-media">
                  {% assign fm = product.selected_or_first_available_variant.featured_media | default: product.featured_media %}
                  {% if fm %}
                    {{ fm | image_url: width: 1200 | image_tag:
                        loading: 'lazy',
                        sizes: '(min-width: 990px) 600px, 100vw',
                        widths: '400,600,800,1000,1200',
                        alt: product.title | escape }}
                  {% else %}
                    {{ 'product-apparel-1' | placeholder_svg_tag: 'placeholder-svg' }}
                  {% endif %}
                </div>
                <div class="fps-info">
                  <h3 class="fps-title h3"><a href="{{ product.url }}">{{ product.title }}</a></h3>
                  <div class="fps-price">
                    {% render 'price', product: product, use_variant: true, show_badges: true %}
                  </div>

                  {% comment %}
                    Keep CTA simple to avoid heavy multi-form JS per slide.
                    Swap to a full buy-buttons render if you really want ATC here.
                  {% endcomment %}
                  <a class="button button--primary fps-cta" href="{{ product.url }}">
                    {{ section.settings.cta_label | default: 'Shop now' }}
                  </a>
                </div>
              </article>
            </div>
          {%- endfor -%}
        {%- else -%}
          {%- for i in (1..3) -%}
            <div class="swiper-slide">
              <article class="fps-card">
                <div class="fps-media">{{ 'product-apparel-1' | placeholder_svg_tag: 'placeholder-svg' }}</div>
                <div class="fps-info">
                  <h3 class="fps-title h3">Featured product</h3>
                  <div class="fps-price">$99.00</div>
                  <a class="button button--primary fps-cta" href="#">Shop now</a>
                </div>
              </article>
            </div>
          {%- endfor -%}
        {%- endif -%}
      </div>
    </div>
  </div>
</section>

{% schema %}
{
  "name": "Featured product slider",
  "class": "section",
  "settings": [
    { "type": "text", "id": "heading", "label": "Heading", "default": "Featured products" },
    { "type": "collection", "id": "collection", "label": "Collection" },
    { "type": "range", "id": "limit", "label": "Products to show", "min": 1, "max": 12, "step": 1, "default": 6 },

    { "type": "text", "id": "cta_label", "label": "CTA label", "default": "Shop now" },

    { "type": "checkbox", "id": "show_arrows", "label": "Show arrows", "default": true },
    { "type": "range", "id": "gap", "label": "Slide gap (px)", "min": 0, "max": 48, "step": 2, "default": 24 },
    { "type": "range", "id": "speed", "label": "Transition speed (ms)", "min": 100, "max": 1200, "step": 50, "default": 500 },
    { "type": "checkbox", "id": "autoplay", "label": "Autoplay", "default": false },
    { "type": "range", "id": "autoplay_delay", "label": "Autoplay delay (ms)", "min": 1500, "max": 8000, "step": 100, "default": 4000 },

    { "type": "header", "content": "Section padding" },
    { "type": "range", "id": "padding_top", "min": 0, "max": 100, "step": 4, "unit": "px", "label": "Padding top", "default": 48 },
    { "type": "range", "id": "padding_bottom", "min": 0, "max": 100, "step": 4, "unit": "px", "label": "Padding bottom", "default": 48 }
  ],
  "presets": [{ "name": "Featured product slider" }]
}
{% endschema %}
