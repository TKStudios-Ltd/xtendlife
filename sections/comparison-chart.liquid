{% comment %} Comparison Chart (fixed-width columns + Swiper) {% endcomment %}

{{ 'component-price.css' | asset_url | stylesheet_tag }}

{%- style -%}
.section-{{ section.id }}-padding{
    padding-top: {{ section.settings.padding_top | times: 0.75 | round: 0 }}px;
    padding-bottom: {{ section.settings.padding_bottom | times: 0.75 | round: 0 }}px;
}
@media (min-width:750px){
    .section-{{ section.id }}-padding{
        padding-top: {{ section.settings.padding_top }}px;
        padding-bottom: {{ section.settings.padding_bottom }}px;
    }
}

  /* ---- Vars ---- */
  #cc-{{ section.id }}{
    --col-w: {{ section.settings.col_width | default: 280 }}px;
    --gap: {{ section.settings.gap | default: 20 }}px;
    --header-h: 200px;
    --row-h: 56px;
    --border: 1px solid rgba(31,25,70,.12);
    --tick-on: #2CAEF6;
    --tick-off: #DBEEFF;
  }

#cc-{{ section.id }} .cc-head{     
    margin-bottom: 3rem;
    font-size: 40px;
    line-height: 1.2;
    max-width: 500px; 
}

  /* ---- Right-bleed container (starts at page-width, bleeds to screen edge) ---- */
  #cc-{{ section.id }} .cc-bleed { width: calc(100vw - ((100vw - 1600px) / 2)); }
  @media (max-width:1599px){
    #cc-{{ section.id }} .cc-bleed{
      --right-gutter: max(0px, calc((100vw - var(--page-width)) / 2 + var(--page-width-margin)));
      width: calc(100% + var(--right-gutter));
      margin-right: var(--right-gutter);
    }
  }

#cc-{{ section.id }} .cc-frame{
    display: flex;
    gap: var(--gap);
    align-items: start;
}
#cc-{{ section.id }} .cc-labels{
    flex: 0 0 240px;
    border: var(--border);
    border-radius: 0;
    overflow: hidden;
    background: #fff;
    display: flex;
    flex-direction: column;
}

#cc-{{ section.id }} .cc-label{
    display: flex;
    align-items: center;
    padding: 0 1rem;
    border-bottom: var(--border);
    font-size: 20px;
    font-weight: 500;
    line-height: 1;
    background: #fff;
    height: 3.5rem;
}
#cc-{{ section.id }} .cc-label:nth-child(2) {
    height: 18rem;
}
#cc-{{ section.id }} .cc-label--spacer{ border-top: 0; padding: 0; background: #fff;  height: 0; }
/* last visible label cell shouldn’t double-border */
#cc-{{ section.id }} .cc-labels .cc-label:last-child{ border-bottom: 0; }

.cc-labels, .cc-col { grid-template-rows: auto repeat(7, minmax(48px, auto)) auto; }


  /* Right (swiper) */
  #cc-{{ section.id }} .cc-right-wrap{
    position: relative;
  }
  #cc-{{ section.id }} .cc-swiper{ overflow: hidden; --g: var(--gap); }
  #cc-{{ section.id }} .cc-swiper .swiper-wrapper{ display:flex; }
  #cc-{{ section.id }} .cc-swiper .swiper-slide{
    width: var(--col-w);
    height: auto;
  }

#cc-{{ section.id }} .cc-col{
    background: #fff;
    border: var(--border);
    border-left: 0;
    border-radius: 0;
    overflow: hidden;
    display: flex;
    flex-direction: column;
}
  #cc-{{ section.id }} .cc-col > *{ border-bottom: var(--border); }
  #cc-{{ section.id }} .cc-col > *:last-child{ border-bottom: 0; }

#cc-{{ section.id }} .cc-header{
    padding: 1rem;
    display: flex;
    gap: 1.5rem;
    align-items: center;
    text-align: left;
    background: #fff;
    height: 18rem;
}
 #cc-{{ section.id }} .cc-media{
    display: flex;
    align-items: center;
    justify-content: center;
    border-radius: 6px;
    background: #F5F6FA;
    overflow: hidden;
    height: 16rem;
    width: 120px;
    min-width: 120px;
}
#cc-{{ section.id }} .cc-media img{ width: 100%; height: 100%; object-fit: contain; }
#cc-{{ section.id }} .cc-title{ margin: 0; font-weight: 500; font-size: 16px; line-height: 1.2; }
#cc-{{ section.id }} .cc-cell{
    display: flex;
    align-items: center;
    justify-content: flex-start;
    padding: 0 1rem;
    text-align: center;
    height: 3.5rem;
}

  /* Ticks (first 5 rows) */
  #cc-{{ section.id }} .cc-ticks{ display: inline-flex; gap: .5rem; }
  #cc-{{ section.id }} .cc-tick{
    width: 16px; height: 16px; border-radius: 999px;
    background: var(--tick-off);
    position: relative; display:inline-block;
  }
  #cc-{{ section.id }} .cc-tick.is-on{
    background: var(--tick-on);
    box-shadow: 0 0 0 3px rgba(44,174,246,.15) inset;
  }

  /* Progressbar under chart (Swiper progressbar styled as “scrollbar”) */
  #cc-{{ section.id }} .cc-progress{
    height: 4px; border-radius: 999px; background: #E8F4FF;
    margin-top: 2rem;
  }
  #cc-{{ section.id }} .cc-progress .swiper-pagination-progressbar-fill{
    background: #1F1946;
    border-radius: 999px;
  }

  /* Small-screen tweaks */
  @media (max-width: 989px){
    #cc-{{ section.id }} .cc-left .cc-rowlabel{ font-size: 15px; }
    #cc-{{ section.id }} .cc-media img{ width: 100px; height: 100px; }
  }

  /* header + 7 data rows + CTA row */
    .cc-labels,
    .cc-col {
    display: grid;
    grid-template-rows: auto repeat(7, minmax(48px, auto)) auto;
    row-gap: 0; /* or whatever you prefer */
    }

    /* price + cta styling */
    .cc-price { font-weight: 600; }
    .cc-cell--cta { padding-top: 1rem; }
    .cc-cell--cta .button { width: fit-content; }

{%- endstyle -%}

<section id="cc-{{ section.id }}" class="section-{{ section.id }}-padding color-{{ section.settings.color_scheme }} isolate gradient">
  <div class="page-width">
    {% if section.settings.heading != blank %}
      <h2 class="cc-head {{ section.settings.heading_size }}">{{ section.settings.heading }}</h2>
    {% endif %}
  </div>

  <div class="page-width">
    <div class="cc-bleed">
      <div class="cc-frame">
        <!-- Left labels -->
        <div class="cc-labels">
        <!-- spacer for product header row -->
        <div class="cc-label cc-label--spacer" aria-hidden="true"></div>

        {%- for i in (1..5) -%}
            {%- assign row_key = 'row' | append: i | append: '_label' -%}
            <div class="cc-label">{{ section.settings[row_key] }}</div>
        {%- endfor -%}

        <div class="cc-label">{{ section.settings.row6_label }}</div>
        <div class="cc-label">Price</div>

        <!-- spacer for CTA row -->
        <div class="cc-label cc-label--spacer" aria-hidden="true"></div>
        </div>

        <!-- Right slider -->
        <div class="cc-right-wrap">
          <div
            id="cc-swiper-{{ section.id }}"
            class="swiper tswiper cc-swiper"
            data-mode="fixed"
            data-gap="{{ section.settings.gap | default: 20 }}"
            data-speed="500"
          >
            <div class="swiper-wrapper">
              {%- for block in section.blocks -%}
                {%- assign p = block.settings.product -%}
                <div class="swiper-slide">
                    <div class="cc-col">
                        <!-- Header row (unchanged) -->
                        <div class="cc-header">
                        {%- assign fm = nil -%}
                        {%- if p -%}{%- assign fm = p.selected_or_first_available_variant.featured_media | default: p.featured_media -%}{%- endif -%}
                        <div class="cc-media">
                            {%- if fm -%}
                            {{ fm | image_url: width: 600 | image_tag: loading: 'lazy', widths: '300,400,500,600', alt: p.title | default: 'Product image' }}
                            {%- else -%}
                            {{ 'product-apparel-1' | placeholder_svg_tag }}
                            {%- endif -%}
                        </div>
                        <p class="cc-title">{{ p.title | default: 'Product name' }}</p>
                        </div>
                        <!-- Rows 1–5 (ticks) -->
                        {%- for r in (1..5) -%}
                        {%- capture tick_key -%}row{{ r }}_ticks{%- endcapture -%}
                        {%- assign ticks = block.settings[tick_key] | default: 0 | plus: 0 -%}
                        <div class="cc-cell">
                            {%- for i in (1..ticks) -%}
                                <span class="cc-tick is-on" aria-hidden="true"></span>
                            {%- endfor -%}
                        </div>
                        {%- endfor -%}
                        <!-- Row 6 (custom text) -->
                        <div class="cc-cell">{{ block.settings.row6_text | default: '-' }}</div>
                        <!-- Row 7 (PRICE – auto from product) -->
                        {%- assign price_val = blank -%}
                        {%- if p -%}
                        {%- assign price_val = p.selected_or_first_available_variant.price | default: p.price -%}
                        {%- endif -%}
                        <div class="cc-cell cc-price">
                        {%- if price_val -%}{{ price_val | money_with_currency }}{%- else -%}- {%- endif -%}
                        </div>
                        <!-- Row 8 (CTA button) -->
                        <div class="cc-cell cc-cell--cta">
                        {%- if p -%}
                            <a href="{{ p.url }}" class="button button--primary">{{ section.settings.shop_cta | default: 'Shop now' }}</a>
                        {%- else -%}
                            <span class="button button--disabled" aria-disabled="true">{{ section.settings.shop_cta | default: 'Shop now' }}</span>
                        {%- endif -%}
                        </div>
                    </div>
                </div>
              {%- endfor -%}
            </div>
          </div>

          <!-- Progress bar (styled as a scrollbar) -->
          <div id="cc-pagination-{{ section.id }}" class="cc-progress swiper-pagination swiper-pagination-progressbar"></div>
        </div>
      </div>
    </div>
  </div>
</section>

{%- comment -%}
Hook the already-initialized Swiper (from swiper-hydrator) and add a progressbar pagination.
This avoids writing a separate full init and keeps using your global hydrator.
{%- endcomment -%}
<script>
(function(){
  const el = document.getElementById('cc-swiper-{{ section.id }}');
  const pag = document.getElementById('cc-pagination-{{ section.id }}');
  function mount(){
    if (!el || typeof Swiper === 'undefined' || !el.swiper) { setTimeout(mount, 60); return; }
    // add/enable progressbar pagination after the hydrator has created the instance
    el.swiper.params.pagination = { el: pag, type: 'progressbar' };
    if (el.swiper.pagination) {
      el.swiper.pagination.init();
      el.swiper.pagination.render();
      el.swiper.pagination.update();
    }
  }
  mount();
})();
</script>

{% schema %}
{
  "name": "Comparison Chart",
  "class": "section",
  "settings": [
    { "type": "inline_richtext", "id": "heading", "label": "Heading", "default": "Which product is right for me?" },
    { "type": "select", "id": "heading_size", "label": "Heading size", "default": "h2", "options": [
      { "value":"h2","label":"H2" }, { "value":"h1","label":"H1" }, { "value":"h0","label":"H0" }, { "value":"hxl","label":"HXL" }, { "value":"hxxl","label":"HXXL" }
    ]},
    { "type": "color_scheme", "id": "color_scheme", "label": "Color scheme", "default": "scheme-1" },

    { "type": "header", "content": "Chart rows" },
    { "type": "text", "id": "row1_label", "label": "Row 1", "default": "Prevent Calcification" },
    { "type": "text", "id": "row2_label", "label": "Row 2", "default": "Cholesterol" },
    { "type": "text", "id": "row3_label", "label": "Row 3", "default": "Blood Circulation" },
    { "type": "text", "id": "row4_label", "label": "Row 4", "default": "Inflammation" },
    { "type": "text", "id": "row5_label", "label": "Row 5", "default": "Statin Support" },
    { "type": "text", "id": "row6_label", "label": "Row 6", "default": "Dosage Per Day" },
    { "type": "text", "id": "shop_cta", "label": "CTA text", "default": "Shop now" },

    { "type": "header", "content": "Layout" },
    { "type": "range", "id": "col_width", "label": "Column width (px)", "min": 220, "max": 360, "step": 10, "default": 280 },
    { "type": "range", "id": "gap", "label": "Column gap (px)", "min": 0, "max": 40, "step": 2, "default": 20 },
    { "type": "range", "id": "max_ticks", "label": "Max ticks per row", "min": 3, "max": 6, "step": 1, "default": 4 },

    { "type": "header", "content": "Section padding" },
    { "type": "range", "id": "padding_top", "min": 0, "max": 100, "step": 4, "unit": "px", "label": "Padding top", "default": 48 },
    { "type": "range", "id": "padding_bottom", "min": 0, "max": 100, "step": 4, "unit": "px", "label": "Padding bottom", "default": 48 }
  ],
  "blocks": [
    {
      "type": "column",
      "name": "Product column",
      "settings": [
        { "type": "product", "id": "product", "label": "Product" },

        { "type": "header", "content": "Ticks (rows 1–5)" },
        { "type": "range", "id": "row1_ticks", "label": "Row 1 ticks", "min": 0, "max": 6, "step": 1, "default": 4 },
        { "type": "range", "id": "row2_ticks", "label": "Row 2 ticks", "min": 0, "max": 6, "step": 1, "default": 3 },
        { "type": "range", "id": "row3_ticks", "label": "Row 3 ticks", "min": 0, "max": 6, "step": 1, "default": 3 },
        { "type": "range", "id": "row4_ticks", "label": "Row 4 ticks", "min": 0, "max": 6, "step": 1, "default": 3 },
        { "type": "range", "id": "row5_ticks", "label": "Row 5 ticks", "min": 0, "max": 6, "step": 1, "default": 3 },

        { "type": "header", "content": "Text values (rows 6)" },
        { "type": "text", "id": "row6_text", "label": "Row 6 text", "default": "3" },
      ]
    }
  ],
  "max_blocks": 10,
  "presets": [{ "name": "Comparison Chart", "blocks": [ { "type":"column" }, { "type":"column" }, { "type":"column" } ] }]
}
{% endschema %}
