{% comment %}
  SAFE INGREDIENT CARDS (Dawn)
  - Accepts: blog (BlogDrop) and/or articles (array of ArticleDrop)
  - If 'articles' not provided, falls back to blog.articles
  - Renders ONLY articles that have a valid handle
  - Shows all cards by default (no initial .hide) to avoid empty screen
{% endcomment %}

{% liquid
  # Resolve the blog
  assign cards_blog = blog
  if cards_blog == blank and blog_handle
    assign cards_blog = blogs[blog_handle]
  endif

  # Resolve the items
  assign the_items = articles
  if the_items == blank
    if cards_blog
      assign the_items = cards_blog.articles
    else
      assign the_items = empty
    endif
  endif

  assign sorted_articles = the_items | sort: 'title'
%}

<section class="ingredient-cards js-filterable" data-filter-name="ingredients">
  <div class="grid grid--2-col-tablet grid--4-col-desktop">
    {% for article in sorted_articles %}
      {% if article and article.handle != blank %}
        {% liquid
          assign first_letter = article.title | slice: 0, 1 | upcase
          if first_letter == blank or first_letter == ' '
            assign first_letter = '0-9'
          endif
          if first_letter contains '0' or first_letter contains '1' or first_letter contains '2' or first_letter contains '3' or first_letter contains '4' or first_letter contains '5' or first_letter contains '6' or first_letter contains '7' or first_letter contains '8' or first_letter contains '9'
            assign first_letter = '0-9'
          endif

          assign blog_handle_safe = cards_blog.handle
          if blog_handle_safe == blank and blog_handle
            assign blog_handle_safe = blog_handle
          endif

          assign article_path = '/blogs/' | append: blog_handle_safe | append: '/articles/' | append: article.handle
        %}

        <div class="grid__item">
          <article
            class="ingredient-card js-ingredient-card"
            data-filter-letter="{{ first_letter }}"
            data-article-url="{{ article_path }}"
            data-blog-handle="{{ blog_handle_safe }}"
            data-article-handle="{{ article.handle }}"
          >
            <a class="ingredient-card__media" href="{{ article_path }}">
              {% if article.image %}
                {{
                  article.image
                  | image_url: width: 220, height: 220, crop: 'center'
                  | image_tag:
                    alt: article.image.alt | default: article.title,
                    loading: 'lazy',
                    widths: '110,220,330',
                    sizes: '(min-width: 990px) 110px, 25vw'
                }}
              {% endif %}
            </a>

            <div class="ingredient-card__details">
              <h3 class="ingredient-card__title">
                <a class="ingredient-card__title--link" href="{{ article_path }}">{{ article.title }}</a>
              </h3>
              {% if article.excerpt != blank %}
                <p class="ingredient-card__excerpt">{{ article.excerpt | strip_html }}</p>
              {% endif %}
            </div>

            <div class="ingredient-card__products js-ingredient-products" aria-live="polite"></div>
          </article>
        </div>
      {% endif %}
    {% endfor %}
  </div>
</section>
